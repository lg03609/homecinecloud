define(["exports","./../modules/viewmanager/baseview.js","./../modules/loading/loading.js","./../modules/common/globalize.js","./../modules/emby-elements/emby-input/emby-input.js","./../modules/emby-elements/emby-button/emby-button.js","./../modules/emby-elements/emby-checkbox/emby-checkbox.js","./../modules/emby-elements/emby-select/emby-select.js","./../modules/approuter.js"],function(_exports,_baseview,_loading,_globalize,_embyInput,_embyButton,_embyCheckbox,_embySelect,_approuter){function loadUser(page){page.querySelector(".txtUserName").value="",_loading.default.show();var promise4=ApiClient.getJSON(ApiClient.getUrl("Library/SelectableMediaFolders",{IsHidden:!1})),promise5=ApiClient.getJSON(ApiClient.getUrl("Channels"));Promise.all([promise4,promise5]).then(function(responses){!function(page,mediaFolders){for(var html="",i=0,length=mediaFolders.length;i<length;i++){var folder=mediaFolders[i];html+='<label><input type="checkbox" is="emby-checkbox" class="chkFolder" data-id="'+(folder.Guid||folder.Id)+'" checked="checked"/><span>'+folder.Name+"</span></label>"}page.querySelector(".folderAccess").innerHTML=html,page.querySelector(".chkEnableAllFolders").checked=!0,page.querySelector(".chkEnableAllFolders").dispatchEvent(new CustomEvent("change",{bubbles:!0,cancelable:!1}))}(page,responses[0]),function(page,channels){for(var html="",i=0,length=channels.length;i<length;i++){var folder=channels[i];html+='<label><input type="checkbox" is="emby-checkbox" class="chkChannel" data-id="'+(folder.Guid||folder.Id)+'" checked="checked"/><span>'+folder.Name+"</span></label>"}page.querySelector(".channelAccess").innerHTML=html,page.querySelector(".channelAccess").classList.remove("hide"),channels.length?page.querySelector(".channelAccessContainer").classList.remove("hide"):page.querySelector(".channelAccessContainer").classList.add("hide"),page.querySelector(".chkEnableAllChannels").checked=!0,page.querySelector(".chkEnableAllChannels").dispatchEvent(new CustomEvent("change",{bubbles:!0,cancelable:!1}))}(page,responses[1].Items),_loading.default.hide()})}function saveUser(page){var name=page.querySelector(".txtUserName").value;ApiClient.createUser(name).then(function(user){user.Policy.IsAdministrator=page.querySelector(".chkIsAdmin").checked,user.Policy.EnableSubtitleDownloading=user.Policy.IsAdministrator,user.Policy.EnableSubtitleManagement=user.Policy.IsAdministrator,user.Policy.EnableContentDeletion=user.Policy.IsAdministrator,user.Policy.EnableAllFolders=page.querySelector(".chkEnableAllFolders").checked,user.Policy.EnabledFolders=user.Policy.EnableAllFolders?[]:Array.prototype.filter.call(page.querySelectorAll(".chkFolder"),function(i){return i.checked}).map(function(i){return i.getAttribute("data-id")}),user.Policy.EnableAllChannels=page.querySelector(".chkEnableAllChannels").checked,user.Policy.EnabledChannels=user.Policy.EnableAllChannels?[]:Array.prototype.filter.call(page.querySelectorAll(".chkChannel"),function(i){return i.checked}).map(function(i){return i.getAttribute("data-id")}),ApiClient.updateUserPolicy(user.Id,user.Policy).then(function(){!function(user){_approuter.default.show("users/user?userId="+user.Id)}(user)})},function(response){var options;400===response.status?(options={text:page.querySelector(".labelNewUserNameHelp").innerHTML},require(["alert"]).then(function(responses){responses[0](options)})):require(["toast"],function(toast){toast(_globalize.default.translate("DefaultErrorMessage"))}),_loading.default.hide()})}function onSubmit(e){var page=this.closest(".page");return _loading.default.show(),saveUser(page),e.preventDefault(),e.stopPropagation(),!1}function View(view,params){_baseview.default.apply(this,arguments),view.querySelector(".btnCancel").addEventListener("click",function(){_approuter.default.back()}),view.querySelector(".chkEnableAllChannels").addEventListener("change",function(){this.checked?view.querySelector(".channelAccess").classList.add("hide"):view.querySelector(".channelAccess").classList.remove("hide")}),view.querySelector(".chkEnableAllFolders").addEventListener("change",function(){this.checked?view.querySelector(".folderAccess").classList.add("hide"):view.querySelector(".folderAccess").classList.remove("hide")}),view.querySelector(".newUserProfileForm").addEventListener("submit",onSubmit)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Object.assign(View.prototype,_baseview.default.prototype),View.prototype.onResume=function(options){_baseview.default.prototype.onResume.apply(this,arguments),loadUser(this.view)},_exports.default=View});